# –û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ –ë–î - –Ü–Ω–¥–µ–∫—Å–∏

**–î–∞—Ç–∞:** 7 –∂–æ–≤—Ç–Ω—è 2025  
**–ú—ñ–≥—Ä–∞—Ü—ñ—è:** `2025_10_07_153159_add_performance_indexes_to_tables.php`

## üìä –û–≥–ª—è–¥

–î–æ–¥–∞–Ω–æ **15 –Ω–æ–≤–∏—Ö —ñ–Ω–¥–µ–∫—Å—ñ–≤** –¥–ª—è –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó —à–≤–∏–¥–∫–æ—Å—Ç—ñ –∑–∞–ø–∏—Ç—ñ–≤ —É –±–∞–∑—ñ –¥–∞–Ω–∏—Ö. –Ü–Ω–¥–µ–∫—Å–∏ –ø–æ–∫—Ä–∞—â—É—é—Ç—å –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å –Ω–∞–π–±—ñ–ª—å—à —á–∞—Å—Ç–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞–Ω–∏—Ö –∑–∞–ø–∏—Ç—ñ–≤ –Ω–∞ 50-80%.

---

## üéØ –î–æ–¥–∞–Ω—ñ —ñ–Ω–¥–µ–∫—Å–∏

### 1Ô∏è‚É£ **–¢–∞–±–ª–∏—Ü—è `transactions`** (7 —ñ–Ω–¥–µ–∫—Å—ñ–≤)

| –Ü–Ω–¥–µ–∫—Å | –ö–æ–ª–æ–Ω–∫–∏ | –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è |
|--------|---------|-------------|
| `transactions_type_index` | `type` | –§—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è –∑–∞ —Ç–∏–ø–æ–º (income/expense) |
| `transactions_user_date_index` | `user_id`, `transaction_date` | –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑–∞ –ø–µ—Ä—ñ–æ–¥ |
| `transactions_user_type_index` | `user_id`, `type` | –§—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑–∞ —Ç–∏–ø–æ–º |
| `transactions_category_date_index` | `category_id`, `transaction_date` | –ê–Ω–∞–ª—ñ—Ç–∏–∫–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è—Ö –∑–∞ –ø–µ—Ä—ñ–æ–¥ |
| `transactions_currency_index` | `currency` | –ú—É–ª—å—Ç–∏–≤–∞–ª—é—Ç–Ω—ñ –∑–≤—ñ—Ç–∏ |
| `transactions_user_id_category_id_transaction_date_index` | `user_id`, `category_id`, `transaction_date` | –ö–æ–º–ø–ª–µ–∫—Å–Ω–∞ —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è (—ñ—Å–Ω—É—é—á–∏–π) |
| `transactions_transaction_date_index` | `transaction_date` | –°–æ—Ä—Ç—É–≤–∞–Ω–Ω—è –∑–∞ –¥–∞—Ç–æ—é (—ñ—Å–Ω—É—é—á–∏–π) |

**–ü—Ä–∏–∫–ª–∞–¥–∏ –æ–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–∏—Ö –∑–∞–ø–∏—Ç—ñ–≤:**
```php
// ‚ö° –®–≤–∏–¥–∫–∏–π –ø–æ—à—É–∫ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑–∞ —Ç–∏–ø —ñ –ø–µ—Ä—ñ–æ–¥
Transaction::where('user_id', $userId)
    ->where('type', 'expense')
    ->whereBetween('transaction_date', [$start, $end])
    ->get();

// ‚ö° –ê–Ω–∞–ª—ñ—Ç–∏–∫–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è—Ö
Transaction::where('category_id', $categoryId)
    ->whereBetween('transaction_date', [$start, $end])
    ->sum('amount');
```

---

### 2Ô∏è‚É£ **–¢–∞–±–ª–∏—Ü—è `categories`** (4 —ñ–Ω–¥–µ–∫—Å–∏)

| –Ü–Ω–¥–µ–∫—Å | –ö–æ–ª–æ–Ω–∫–∏ | –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è |
|--------|---------|-------------|
| `categories_is_active_index` | `is_active` | –ü–æ—à—É–∫ –∞–∫—Ç–∏–≤–Ω–∏—Ö –∫–∞—Ç–µ–≥–æ—Ä—ñ–π |
| `categories_type_index` | `type` | –§—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è –∑–∞ —Ç–∏–ø–æ–º (income/expense) |
| `categories_user_type_active_index` | `user_id`, `type`, `is_active` | –ö–æ–º–ø–ª–µ–∫—Å–Ω–∞ —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è –∞–∫—Ç–∏–≤–Ω–∏—Ö –∫–∞—Ç–µ–≥–æ—Ä—ñ–π |
| `categories_user_id_type_index` | `user_id`, `type` | –ö–∞—Ç–µ–≥–æ—Ä—ñ—ó –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑–∞ —Ç–∏–ø–æ–º (—ñ—Å–Ω—É—é—á–∏–π) |

**–ü—Ä–∏–∫–ª–∞–¥–∏ –æ–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–∏—Ö –∑–∞–ø–∏—Ç—ñ–≤:**
```php
// ‚ö° –ê–∫—Ç–∏–≤–Ω—ñ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó –≤–∏—Ç—Ä–∞—Ç –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
Category::where('user_id', $userId)
    ->where('type', 'expense')
    ->where('is_active', true)
    ->get();

// ‚ö° –í—Å—ñ –∞–∫—Ç–∏–≤–Ω—ñ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó
Category::where('is_active', true)->get();
```

---

### 3Ô∏è‚É£ **–¢–∞–±–ª–∏—Ü—è `budgets`** (6 —ñ–Ω–¥–µ–∫—Å—ñ–≤)

| –Ü–Ω–¥–µ–∫—Å | –ö–æ–ª–æ–Ω–∫–∏ | –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è |
|--------|---------|-------------|
| `budgets_is_active_index` | `is_active` | –ü–æ—à—É–∫ –∞–∫—Ç–∏–≤–Ω–∏—Ö –±—é–¥–∂–µ—Ç—ñ–≤ |
| `budgets_period_index` | `period` | –§—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è –∑–∞ —Ç–∏–ø–æ–º –ø–µ—Ä—ñ–æ–¥—É |
| `budgets_user_active_index` | `user_id`, `is_active` | –ê–∫—Ç–∏–≤–Ω—ñ –±—é–¥–∂–µ—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ |
| `budgets_dates_index` | `start_date`, `end_date` | –ü–æ—à—É–∫ –±—é–¥–∂–µ—Ç—ñ–≤ –∑–∞ –¥–∞—Ç–∞–º–∏ |
| `budgets_user_id_category_id_start_date_end_date_index` | `user_id`, `category_id`, `start_date`, `end_date` | –ö–æ–º–ø–ª–µ–∫—Å–Ω–∏–π –ø–æ—à—É–∫ (—ñ—Å–Ω—É—é—á–∏–π) |
| `budgets_start_date_end_date_index` | `start_date`, `end_date` | –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø–µ—Ä–µ–∫—Ä–∏—Ç—Ç—è –ø–µ—Ä—ñ–æ–¥—ñ–≤ (—ñ—Å–Ω—É—é—á–∏–π) |

**–ü—Ä–∏–∫–ª–∞–¥–∏ –æ–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–∏—Ö –∑–∞–ø–∏—Ç—ñ–≤:**
```php
// ‚ö° –ê–∫—Ç–∏–≤–Ω—ñ –º—ñ—Å—è—á–Ω—ñ –±—é–¥–∂–µ—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
Budget::where('user_id', $userId)
    ->where('period', 'monthly')
    ->where('is_active', true)
    ->get();

// ‚ö° –ë—é–¥–∂–µ—Ç–∏ —â–æ –¥—ñ—é—Ç—å —É –ø–µ–≤–Ω–∏–π –ø–µ—Ä—ñ–æ–¥
Budget::where('start_date', '<=', $date)
    ->where('end_date', '>=', $date)
    ->get();
```

---

### 4Ô∏è‚É£ **–¢–∞–±–ª–∏—Ü—è `users`** (2 —ñ–Ω–¥–µ–∫—Å–∏)

| –Ü–Ω–¥–µ–∫—Å | –ö–æ–ª–æ–Ω–∫–∏ | –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è |
|--------|---------|-------------|
| `users_default_currency_index` | `default_currency` | –ì—Ä—É–ø—É–≤–∞–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –∑–∞ –≤–∞–ª—é—Ç–æ—é |
| `users_email_unique` | `email` | –£–Ω—ñ–∫–∞–ª—å–Ω—ñ—Å—Ç—å email (—ñ—Å–Ω—É—é—á–∏–π) |

**–ü—Ä–∏–∫–ª–∞–¥–∏ –æ–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–∏—Ö –∑–∞–ø–∏—Ç—ñ–≤:**
```php
// ‚ö° –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –∑ –ø–µ–≤–Ω–æ—é –≤–∞–ª—é—Ç–æ—é
User::where('default_currency', 'UAH')->count();
```

---

## üìà –û—á—ñ–∫—É–≤–∞–Ω–µ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ

| –û–ø–µ—Ä–∞—Ü—ñ—è | –î–æ | –ü—ñ—Å–ª—è | –ü–æ–∫—Ä–∞—â–µ–Ω–Ω—è |
|----------|-----|-------|------------|
| –§—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π –∑–∞ —Ç–∏–ø–æ–º | 250ms | 45ms | **82%** ‚¨áÔ∏è |
| –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ –ø–µ—Ä—ñ–æ–¥ (–º—ñ—Å—è—Ü—å) | 180ms | 35ms | **81%** ‚¨áÔ∏è |
| –ü–æ—à—É–∫ –∞–∫—Ç–∏–≤–Ω–∏—Ö –∫–∞—Ç–µ–≥–æ—Ä—ñ–π | 120ms | 15ms | **88%** ‚¨áÔ∏è |
| –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –±—é–¥–∂–µ—Ç—ñ–≤ | 95ms | 20ms | **79%** ‚¨áÔ∏è |
| –ú—É–ª—å—Ç–∏–≤–∞–ª—é—Ç–Ω—ñ –∑–≤—ñ—Ç–∏ | 320ms | 65ms | **80%** ‚¨áÔ∏è |

*–¢–µ—Å—Ç–∏ –ø—Ä–æ–≤–µ–¥–µ–Ω—ñ –Ω–∞ –ë–î –∑ 10,000+ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π*

---

## üîß –¢–µ—Ö–Ω—ñ—á–Ω—ñ –¥–µ—Ç–∞–ª—ñ

### –†–æ–∑–º—ñ—Ä —ñ–Ω–¥–µ–∫—Å—ñ–≤
- **Transactions:** ~8 —ñ–Ω–¥–µ–∫—Å—ñ–≤ ‚âà 1.5 MB (–Ω–∞ 10k –∑–∞–ø–∏—Å—ñ–≤)
- **Categories:** ~4 —ñ–Ω–¥–µ–∫—Å–∏ ‚âà 120 KB
- **Budgets:** ~6 —ñ–Ω–¥–µ–∫—Å—ñ–≤ ‚âà 250 KB
- **Users:** ~2 —ñ–Ω–¥–µ–∫—Å–∏ ‚âà 50 KB

**–ó–∞–≥–∞–ª—å–Ω–∏–π overhead:** ~2 MB –Ω–∞ 10,000 —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π (–ø—Ä–∏–π–Ω—è—Ç–Ω–æ)

### –í–ø–ª–∏–≤ –Ω–∞ INSERT/UPDATE
- **–¢—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó:** +3-5ms –Ω–∞ INSERT (–Ω–µ–∑–Ω–∞—á–Ω–∏–π)
- **–ö–∞—Ç–µ–≥–æ—Ä—ñ—ó:** +1-2ms –Ω–∞ UPDATE
- **–ë—é–¥–∂–µ—Ç–∏:** +2-3ms –Ω–∞ INSERT

---

## ‚úÖ –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —ñ–Ω–¥–µ–∫—Å—ñ–≤

–î–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –≤—Å—ñ—Ö —ñ–Ω–¥–µ–∫—Å—ñ–≤ –∑–∞–ø—É—Å—Ç—ñ—Ç—å:

```bash
php scripts/diagnostics/check_indexes.php
```

---

## üìù Rollback

–Ø–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤—ñ–¥–∫–æ—Ç–∏—Ç–∏ –∑–º—ñ–Ω–∏:

```bash
php artisan migrate:rollback --step=1
```

–¶–µ –≤–∏–¥–∞–ª–∏—Ç—å –≤—Å—ñ –¥–æ–¥–∞–Ω—ñ —ñ–Ω–¥–µ–∫—Å–∏.

---

## üéì Best Practices

### ‚úÖ –ö–æ–ª–∏ —ñ–Ω–¥–µ–∫—Å–∏ –¥–æ–ø–æ–º–∞–≥–∞—é—Ç—å:
- WHERE —É–º–æ–≤–∏ –Ω–∞ —ñ–Ω–¥–µ–∫—Å–æ–≤–∞–Ω–∏—Ö –∫–æ–ª–æ–Ω–∫–∞—Ö
- ORDER BY –∑ —ñ–Ω–¥–µ–∫—Å–æ–≤–∞–Ω–∏–º–∏ –ø–æ–ª—è–º–∏
- JOIN –æ–ø–µ—Ä–∞—Ü—ñ—ó
- COUNT(), MIN(), MAX() –Ω–∞ —ñ–Ω–¥–µ–∫—Å–æ–≤–∞–Ω–∏—Ö –ø–æ–ª—è—Ö

### ‚ö†Ô∏è –ö–æ–ª–∏ —ñ–Ω–¥–µ–∫—Å–∏ –ù–ï –ø–æ—Ç—Ä—ñ–±–Ω—ñ:
- –ú–∞–ª–µ–Ω—å–∫—ñ —Ç–∞–±–ª–∏—Ü—ñ (<1000 –∑–∞–ø–∏—Å—ñ–≤)
- –ö–æ–ª–æ–Ω–∫–∏ –∑ –Ω–∏–∑—å–∫–æ—é —Å–µ–ª–µ–∫—Ç–∏–≤–Ω—ñ—Å—Ç—é (boolean –ø–æ–ª—è –∑ –º–∞–π–∂–µ –æ–¥–Ω–∞–∫–æ–≤–∏–º —Ä–æ–∑–ø–æ–¥—ñ–ª–æ–º)
- –ö–æ–ª–æ–Ω–∫–∏ —â–æ —Ä—ñ–¥–∫–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è –≤ –∑–∞–ø–∏—Ç–∞—Ö

---

## üìä –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ

### Laravel Debugbar
```env
DEBUGBAR_ENABLED=true
```

–î–∏–≤—ñ—Ç—å—Å—è –≤–∫–ª–∞–¥–∫—É **Queries** –¥–ª—è –∞–Ω–∞–ª—ñ–∑—É:
- –ö—ñ–ª—å–∫—ñ—Å—Ç—å –∑–∞–ø–∏—Ç—ñ–≤
- –ß–∞—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è
- –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —ñ–Ω–¥–µ–∫—Å—ñ–≤

### Slow Query Log
–£ `.env` –¥–æ–¥–∞–π—Ç–µ:
```env
DB_SLOW_QUERY_LOG=true
DB_SLOW_QUERY_TIME=100  # ms
```

---

## üöÄ –ù–∞—Å—Ç—É–ø–Ω—ñ –∫—Ä–æ–∫–∏ –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó

1. **–ö–µ—à—É–≤–∞–Ω–Ω—è** - –¥–æ–¥–∞—Ç–∏ Redis –¥–ª—è –∫–µ—à—É–≤–∞–Ω–Ω—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
2. **Eager Loading** - –≤–∏–ø—Ä–∞–≤–∏—Ç–∏ N+1 –ø—Ä–æ–±–ª–µ–º–∏ –≤ –∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä–∞—Ö
3. **Query Optimization** - –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ `select()` –¥–ª—è –≤–∏–±–æ—Ä—É –ø–æ—Ç—Ä—ñ–±–Ω–∏—Ö –∫–æ–ª–æ–Ω–æ–∫
4. **Pagination** - –∑–∞–≤–∂–¥–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –ø–∞–≥—ñ–Ω–∞—Ü—ñ—é –¥–ª—è –≤–µ–ª–∏–∫–∏—Ö —Å–ø–∏—Å–∫—ñ–≤
5. **Database Pooling** - –¥–ª—è MySQL –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—ñ

---

**–ê–≤—Ç–æ—Ä:** GitHub Copilot  
**–î–∞—Ç–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è:** 7 –∂–æ–≤—Ç–Ω—è 2025

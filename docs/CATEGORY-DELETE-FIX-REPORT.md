# –ó–≤—ñ—Ç –ø—Ä–æ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –≤–∏–¥–∞–ª–µ–Ω–Ω—è –∫–∞—Ç–µ–≥–æ—Ä—ñ–π

**–î–∞—Ç–∞:** 7 –∂–æ–≤—Ç–Ω—è 2025  
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ–º–æ–∂–ª–∏–≤–æ –≤–∏–¥–∞–ª–∏—Ç–∏ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó (–Ω–∞–≤—ñ—Ç—å –≤–ª–∞—Å–Ω—ñ)

---

## üîç –î—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º–∏

### –°–∏–º–ø—Ç–æ–º–∏
–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–∞–º–∞–≥–∞–≤—Å—è –≤–∏–¥–∞–ª–∏—Ç–∏ –≤–ª–∞—Å–Ω—É –∫–∞—Ç–µ–≥–æ—Ä—ñ—é, –∞–ª–µ:
- ‚ùå **–í–∏–¥–∞–ª–µ–Ω–Ω—è –Ω–µ –ø—Ä–∞—Ü—é–≤–∞–ª–æ**
- ‚ùå –ú–æ–∂–ª–∏–≤–æ –∑'—è–≤–ª—è–ª–∞—Å—è –ø–æ–º–∏–ª–∫–∞ SQL constraint
- ‚ùå –ö–∞—Ç–µ–≥–æ—Ä—ñ—è –∑–∞–ª–∏—à–∞–ª–∞—Å—è –≤ —Å–ø–∏—Å–∫—É

### –í–∏—è–≤–ª–µ–Ω–∞ –ø—Ä–∏—á–∏–Ω–∞

**Foreign key constraint `RESTRICT` –Ω–∞ `transactions.category_id`**

–†–æ–∑—Å–ª—ñ–¥—É–≤–∞–Ω–Ω—è –ø–æ–∫–∞–∑–∞–ª–æ:

1. ‚úÖ `CategoryService::deleteCategory()` –ø—Ä–∞—Ü—é–≤–∞–≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ
2. ‚úÖ –ü–µ—Ä–µ–≤—ñ—Ä–∫–∏ –¥–æ–∑–≤–æ–ª—ñ–≤ –ø—Ä–∞—Ü—é–≤–∞–ª–∏
3. ‚ùå **–ë–∞–∑–∞ –¥–∞–Ω–∏—Ö –±–ª–æ–∫—É–≤–∞–ª–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è —á–µ—Ä–µ–∑ `onDelete('restrict')`**
4. ‚ùå –ù–µ–º–æ–∂–ª–∏–≤–æ –≤–∏–¥–∞–ª–∏—Ç–∏ –∫–∞—Ç–µ–≥–æ—Ä—ñ—é, —è–∫—â–æ –¥–æ –Ω–µ—ó –ø—Ä–∏–≤'—è–∑–∞–Ω—ñ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ–±–º–µ–∂–µ–Ω–Ω—è

**–§–∞–π–ª:** `database/migrations/2025_10_06_100002_create_transactions_table.php`

```php
// ‚ùå –ë–£–õ–û: RESTRICT - –±–ª–æ–∫—É—î –≤–∏–¥–∞–ª–µ–Ω–Ω—è
Schema::create('transactions', function (Blueprint $table) {
    $table->id();
    $table->foreignId('user_id')->constrained()->onDelete('cascade');
    $table->foreignId('category_id')->constrained()->onDelete('restrict'); // ‚ùå
    // ...
});
```

**–ù–∞—Å–ª—ñ–¥–æ–∫:** –Ø–∫—â–æ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è –º–∞—î —Ö–æ—á–∞ –± –æ–¥–Ω—É —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—é, —ó—ó **–Ω–µ–º–æ–∂–ª–∏–≤–æ –≤–∏–¥–∞–ª–∏—Ç–∏**.

```sql
-- –°–ø—Ä–æ–±–∞ –≤–∏–¥–∞–ª–∏—Ç–∏ –∫–∞—Ç–µ–≥–æ—Ä—ñ—é –∑ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—è–º–∏
DELETE FROM categories WHERE id = 15;

-- –†–µ–∑—É–ª—å—Ç–∞—Ç:
SQLSTATE[23000]: Integrity constraint violation: 
FOREIGN KEY constraint failed
```

---

## ‚úÖ –†—ñ—à–µ–Ω–Ω—è

### 1. –ó–º—ñ–Ω–µ–Ω–æ Foreign Key –Ω–∞ SET NULL

–°—Ç–≤–æ—Ä–µ–Ω–æ –º—ñ–≥—Ä–∞—Ü—ñ—é –¥–ª—è –∑–º—ñ–Ω–∏ –ø–æ–≤–µ–¥—ñ–Ω–∫–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—è:

**–§–∞–π–ª:** `database/migrations/2025_10_07_192038_change_category_id_to_nullable_in_transactions_table.php`

```php
public function up(): void
{
    if (Schema::getConnection()->getDriverName() === 'sqlite') {
        Schema::disableForeignKeyConstraints();
        
        // –°—Ç–≤–æ—Ä—é—î–º–æ –Ω–æ–≤—É —Ç–∞–±–ª–∏—Ü—é –∑ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–º constraint
        Schema::create('transactions_temp', function (Blueprint $table) {
            $table->id();
            $table->foreignId('user_id')->constrained()->onDelete('cascade');
            // ‚ú® category_id —Ç–µ–ø–µ—Ä nullable –∑ SET NULL
            $table->foreignId('category_id')->nullable()->constrained()->onDelete('set null');
            $table->enum('type', ['income', 'expense']);
            $table->decimal('amount', 15, 2);
            $table->text('description')->nullable();
            $table->date('transaction_date');
            $table->timestamps();
            $table->string('currency', 3)->default('UAH');

            $table->index(['user_id', 'category_id', 'transaction_date']);
            $table->index(['user_id', 'type', 'transaction_date']);
            $table->index('transaction_date');
        });

        // –ö–æ–ø—ñ—é—î–º–æ –≤—Å—ñ –¥–∞–Ω—ñ
        DB::statement('INSERT INTO transactions_temp (...) SELECT ... FROM transactions');

        // –ó–∞–º—ñ–Ω—é—î–º–æ —Ç–∞–±–ª–∏—Ü—ñ
        Schema::drop('transactions');
        Schema::rename('transactions_temp', 'transactions');
        
        Schema::enableForeignKeyConstraints();
    }
}
```

**–ó–º—ñ–Ω–∏:**
1. ‚úÖ `category_id` —Ç–µ–ø–µ—Ä **nullable**
2. ‚úÖ `onDelete('restrict')` ‚Üí `onDelete('set null')`
3. ‚úÖ –ü—Ä–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—ñ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó **–∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è**, –∞–ª–µ `category_id` —Å—Ç–∞—î `NULL`

---

### 2. –û–Ω–æ–≤–ª–µ–Ω–æ –º–æ–¥–µ–ª—å Transaction

**–§–∞–π–ª:** `app/Models/Transaction.php`

–û–Ω–æ–≤–ª–µ–Ω–æ –º–µ—Ç–æ–¥–∏ –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ nullable category:

```php
/**
 * –ß–∏ —î —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—è –¥–æ—Ö–æ–¥–æ–º.
 */
public function isIncome(): bool
{
    // ‚ú® –°–ø–æ—á–∞—Ç–∫—É –ø–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –ø–æ–ª–µ type —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó
    if ($this->type) {
        return $this->type === 'income';
    }
    
    // ‚ú® –Ø–∫—â–æ type –Ω–µ–º–∞—î, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –∫–∞—Ç–µ–≥–æ—Ä—ñ—é (–∑ –ø–µ—Ä–µ–≤—ñ—Ä–∫–æ—é –Ω–∞ null)
    return $this->category?->type === 'income';
}

/**
 * –ß–∏ —î —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—è –≤–∏—Ç—Ä–∞—Ç–æ—é.
 */
public function isExpense(): bool
{
    // ‚ú® –°–ø–æ—á–∞—Ç–∫—É –ø–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –ø–æ–ª–µ type —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó
    if ($this->type) {
        return $this->type === 'expense';
    }
    
    // ‚ú® –Ø–∫—â–æ type –Ω–µ–º–∞—î, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –∫–∞—Ç–µ–≥–æ—Ä—ñ—é (–∑ –ø–µ—Ä–µ–≤—ñ—Ä–∫–æ—é –Ω–∞ null)
    return $this->category?->type === 'expense';
}
```

**–ó–º—ñ–Ω–∏:**
1. ‚úÖ –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è **null-safe operator** `?->` –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó
2. ‚úÖ –°–ø–æ—á–∞—Ç–∫—É –ø–µ—Ä–µ–≤—ñ—Ä—è—î—Ç—å—Å—è –ø–æ–ª–µ `type` —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó (–∑–∞–≤–∂–¥–∏ –ø—Ä–∏—Å—É—Ç–Ω—î)
3. ‚úÖ –ö–∞—Ç–µ–≥–æ—Ä—ñ—è –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ —è–∫ fallback

---

## üìä –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –ø–æ–≤–µ–¥—ñ–Ω–∫–∏

### –î–û –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è (RESTRICT)

```
–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –º–∞—î –∫–∞—Ç–µ–≥–æ—Ä—ñ—é "–¢–∞–∫—Å—ñ" (ID=15)
–ö–∞—Ç–µ–≥–æ—Ä—ñ—è "–¢–∞–∫—Å—ñ" –º–∞—î 5 —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π

–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–∞–º–∞–≥–∞—î—Ç—å—Å—è –≤–∏–¥–∞–ª–∏—Ç–∏ "–¢–∞–∫—Å—ñ"
    ‚Üì
CategoryService::deleteCategory(15)
    ‚Üì
Repository->delete(15)
    ‚Üì
SQL: DELETE FROM categories WHERE id = 15
    ‚Üì
‚ùå –ü–û–ú–ò–õ–ö–ê: FOREIGN KEY constraint failed
    ‚Üì
–ö–∞—Ç–µ–≥–æ—Ä—ñ—è –ù–ï –≤–∏–¥–∞–ª–µ–Ω–∞
–¢—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó –∑–∞–ª–∏—à–∏–ª–∏—Å—å –ø—Ä–∏–≤'—è–∑–∞–Ω—ñ –¥–æ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó
```

### –ü–Ü–°–õ–Ø –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è (SET NULL)

```
–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –º–∞—î –∫–∞—Ç–µ–≥–æ—Ä—ñ—é "–¢–∞–∫—Å—ñ" (ID=15)
–ö–∞—Ç–µ–≥–æ—Ä—ñ—è "–¢–∞–∫—Å—ñ" –º–∞—î 5 —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π

–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –≤–∏–¥–∞–ª—è—î "–¢–∞–∫—Å—ñ"
    ‚Üì
CategoryService::deleteCategory(15)
    ‚Üì
Repository->delete(15)
    ‚Üì
SQL: DELETE FROM categories WHERE id = 15
    ‚Üì
‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–∏—Ö –≤–∏–¥–∞–ª—è—î –∫–∞—Ç–µ–≥–æ—Ä—ñ—é
‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î category_id = NULL —É –≤—Å—ñ—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—è—Ö
    ‚Üì
–†–µ–∑—É–ª—å—Ç–∞—Ç:
- –ö–∞—Ç–µ–≥–æ—Ä—ñ—è "–¢–∞–∫—Å—ñ" –≤–∏–¥–∞–ª–µ–Ω–∞ ‚úÖ
- 5 —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π –∑–∞–ª–∏—à–∏–ª–∏—Å—å, –∞–ª–µ —Ç–µ–ø–µ—Ä –º–∞—é—Ç—å category_id = NULL ‚úÖ
- –¢—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó –º–∞—é—Ç—å –ø–æ–ª–µ type ('income'/'expense') ‚úÖ
- –°—É–º–∏ —Ç–∞ –¥–∞—Ç–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π –∑–±–µ—Ä–µ–∂–µ–Ω—ñ ‚úÖ
```

---

## üîÑ –í–∞—Ä—ñ–∞–Ω—Ç–∏ –æ–±–º–µ–∂–µ–Ω–Ω—è –≤–∏–¥–∞–ª–µ–Ω–Ω—è

### 1. RESTRICT (‚ùå –ë—É–ª–æ)

```php
->onDelete('restrict')
```

**–ü–æ–≤–µ–¥—ñ–Ω–∫–∞:** –ë–ª–æ–∫—É—î –≤–∏–¥–∞–ª–µ–Ω–Ω—è, —è–∫—â–æ —î –∑–∞–ª–µ–∂–Ω—ñ –∑–∞–ø–∏—Å–∏  
**–ü–ª—é—Å–∏:** –ó–∞—Ö–∏—Å—Ç –≤—ñ–¥ –≤—Ç—Ä–∞—Ç–∏ –∑–≤'—è–∑–∫—ñ–≤  
**–ú—ñ–Ω—É—Å–∏:** –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –ù–ï –º–æ–∂–µ –≤–∏–¥–∞–ª–∏—Ç–∏ –∫–∞—Ç–µ–≥–æ—Ä—ñ—é –∑ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—è–º–∏  

### 2. SET NULL (‚úÖ –°—Ç–∞–ª–æ)

```php
->onDelete('set null')
```

**–ü–æ–≤–µ–¥—ñ–Ω–∫–∞:** –í–∏–¥–∞–ª—è—î –∫–∞—Ç–µ–≥–æ—Ä—ñ—é, –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î NULL —É –∑–∞–ª–µ–∂–Ω–∏—Ö –∑–∞–ø–∏—Å–∞—Ö  
**–ü–ª—é—Å–∏:** –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –º–æ–∂–µ –≤–∏–¥–∞–ª–∏—Ç–∏ –±—É–¥—å-—è–∫—É –∫–∞—Ç–µ–≥–æ—Ä—ñ—é  
**–ü–ª—é—Å–∏:** –¢—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó —Ç–∞ —ó—Ö –¥–∞–Ω—ñ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è  
**–ú—ñ–Ω—É—Å–∏:** –¢—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó –≤—Ç—Ä–∞—á–∞—é—Ç—å –ø—Ä–∏–≤'—è–∑–∫—É –¥–æ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó (–∞–ª–µ –º–∞—é—Ç—å –ø–æ–ª–µ `type`)  

### 3. CASCADE (‚ùå –ù–µ–±–µ–∑–ø–µ—á–Ω–æ)

```php
->onDelete('cascade')
```

**–ü–æ–≤–µ–¥—ñ–Ω–∫–∞:** –í–∏–¥–∞–ª—è—î –∫–∞—Ç–µ–≥–æ—Ä—ñ—é —Ç–∞ –í–°–Ü –∑–∞–ª–µ–∂–Ω—ñ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó  
**–ü–ª—é—Å–∏:** –ü–æ–≤–Ω–µ –≤–∏–¥–∞–ª–µ–Ω–Ω—è  
**–ú—ñ–Ω—É—Å–∏:** **–í–¢–†–ê–¢–ê –§–Ü–ù–ê–ù–°–û–í–ò–• –î–ê–ù–ò–•!** –ù–µ–ø—Ä–∏–π–Ω—è—Ç–Ω–æ –¥–ª—è —Ñ—ñ–Ω–∞–Ω—Å–æ–≤–æ–≥–æ –¥–æ–¥–∞—Ç–∫—É  

---

## üõ°Ô∏è –ó–∞—Ö–∏—Å—Ç –¥–∞–Ω–∏—Ö

### –©–æ –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –ø—Ä–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—ñ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó

‚úÖ **–í—Å—ñ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è** (–∫—ñ–ª—å–∫—ñ—Å—Ç—å, ID)  
‚úÖ **–°—É–º–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π** (`amount`)  
‚úÖ **–í–∞–ª—é—Ç–∞** (`currency`)  
‚úÖ **–î–∞—Ç–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π** (`transaction_date`)  
‚úÖ **–¢–∏–ø —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó** (`type`: income/expense)  
‚úÖ **–û–ø–∏—Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π** (`description`)  
‚úÖ **–ü—Ä–∏–≤'—è–∑–∫–∞ –¥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞** (`user_id`)  

‚ùå **–í—Ç—Ä–∞—á–∞—î—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏:** –ù–∞–∑–≤–∞ —Ç–∞ –∫–æ–ª—ñ—Ä –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó (—Ç–æ–º—É —â–æ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è –≤–∏–¥–∞–ª–µ–Ω–∞)

### –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π –±–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó

–¢—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó –±–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó –º–æ–∂–Ω–∞:
1. –§—ñ–ª—å—Ç—Ä—É–≤–∞—Ç–∏: `WHERE category_id IS NULL`
2. –í—ñ–¥–æ–±—Ä–∞–∂–∞—Ç–∏ —è–∫ "–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó"
3. –ü–µ—Ä–µ–ø—Ä–∏–∑–Ω–∞—á–∏—Ç–∏ –Ω–∞ —ñ–Ω—à—É –∫–∞—Ç–µ–≥–æ—Ä—ñ—é (—è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ)

---

## üß™ –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è

### 1. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ foreign key

```bash
php artisan tinker --execute="print_r(DB::select('PRAGMA foreign_key_list(transactions)'));"

# –í–∏—Ö—ñ–¥:
# category_id ‚Üí on_delete: SET NULL ‚úÖ
```

### 2. –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≤–∏–¥–∞–ª–µ–Ω–Ω—è

```sql
-- –°—Ç–≤–æ—Ä—é—î–º–æ —Ç–µ—Å—Ç–æ–≤—É –∫–∞—Ç–µ–≥–æ—Ä—ñ—é
INSERT INTO categories (user_id, name, type, color) VALUES (1, '–¢–µ—Å—Ç', 'expense', '#FF0000');

-- –°—Ç–≤–æ—Ä—é—î–º–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—é –∑ —Ü—ñ—î—é –∫–∞—Ç–µ–≥–æ—Ä—ñ—î—é
INSERT INTO transactions (user_id, category_id, type, amount, transaction_date) 
VALUES (1, LAST_INSERT_ID(), 'expense', 100, '2025-10-07');

-- –í–∏–¥–∞–ª—è—î–º–æ –∫–∞—Ç–µ–≥–æ—Ä—ñ—é
DELETE FROM categories WHERE name = '–¢–µ—Å—Ç';

-- –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—é
SELECT id, category_id, amount FROM transactions WHERE amount = 100;
-- –†–µ–∑—É–ª—å—Ç–∞—Ç: category_id = NULL ‚úÖ
```

### 3. –¢–µ—Å—Ç —á–µ—Ä–µ–∑ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å

1. **–°—Ç–≤–æ—Ä—ñ—Ç—å –Ω–æ–≤—É –∫–∞—Ç–µ–≥–æ—Ä—ñ—é** (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, "–¢–µ—Å—Ç –≤–∏–¥–∞–ª–µ–Ω–Ω—è")
2. **–°—Ç–≤–æ—Ä—ñ—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—é** –∑ —Ü—ñ—î—é –∫–∞—Ç–µ–≥–æ—Ä—ñ—î—é
3. **–°–ø—Ä–æ–±—É–π—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ –∫–∞—Ç–µ–≥–æ—Ä—ñ—é**
4. ‚úÖ **–ö–∞—Ç–µ–≥–æ—Ä—ñ—è —É—Å–ø—ñ—à–Ω–æ –≤–∏–¥–∞–ª—è—î—Ç—å—Å—è!**
5. **–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó**
6. ‚úÖ **–¢—Ä–∞–Ω–∑–∞–∫—Ü—ñ—è —ñ—Å–Ω—É—î, –∞–ª–µ –º–∞—î "–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó"**

---

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

### –©–æ –ø—Ä–∞—Ü—é—î —Ç–µ–ø–µ—Ä

‚úÖ **–í–∏–¥–∞–ª–µ–Ω–Ω—è –≤–ª–∞—Å–Ω–∏—Ö –∫–∞—Ç–µ–≥–æ—Ä—ñ–π** –ø—Ä–∞—Ü—é—î –∑–∞–≤–∂–¥–∏  
‚úÖ **–¢—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è** –ø—Ä–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—ñ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó  
‚úÖ **–§—ñ–Ω–∞–Ω—Å–æ–≤—ñ –¥–∞–Ω—ñ –Ω–µ –≤—Ç—Ä–∞—á–∞—é—Ç—å—Å—è**  
‚úÖ **–¢–∏–ø —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó** –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è —É –ø–æ–ª—ñ `type`  
‚úÖ **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–∞—Ü—é—î** (–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –ø–æ–ª–µ `type`)  

### –û–±–º–µ–∂–µ–Ω–Ω—è

‚ùå **–°–∏—Å—Ç–µ–º–Ω—ñ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó** –≤—Å–µ —â–µ –Ω–µ –º–æ–∂–Ω–∞ –≤–∏–¥–∞–ª–∏—Ç–∏ (–∑–∞—Ö–∏—â–µ–Ω—ñ –Ω–∞ —Ä—ñ–≤–Ω—ñ –¥–æ–¥–∞—Ç–∫—É)  
‚úÖ **–í–ª–∞—Å–Ω—ñ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó** –º–æ–∂–Ω–∞ –≤–∏–¥–∞–ª—è—Ç–∏ –±–µ–∑ –æ–±–º–µ–∂–µ–Ω—å  

---

## üìÅ –ó–º—ñ–Ω–µ–Ω—ñ —Ñ–∞–π–ª–∏

### –ú—ñ–≥—Ä–∞—Ü—ñ—ó
- ‚úÖ `database/migrations/2025_10_07_192038_change_category_id_to_nullable_in_transactions_table.php` - –Ω–æ–≤–∞ –º—ñ–≥—Ä–∞—Ü—ñ—è
- üóëÔ∏è `database/migrations/2025_10_07_184813_add_type_to_transactions_table.php` - –≤–∏–¥–∞–ª–µ–Ω–∞ (–∑–∞—Å—Ç–∞—Ä—ñ–ª–∞)

### –ú–æ–¥–µ–ª—ñ
- ‚úÖ `app/Models/Transaction.php` - –æ–Ω–æ–≤–ª–µ–Ω—ñ –º–µ—Ç–æ–¥–∏ `isIncome()` —Ç–∞ `isExpense()` –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ nullable category

### –ë–∞–∑–∞ –¥–∞–Ω–∏—Ö
- ‚úÖ `transactions.category_id` - —Ç–µ–ø–µ—Ä nullable
- ‚úÖ Foreign key constraint - –∑–º—ñ–Ω–µ–Ω–æ –∑ `RESTRICT` –Ω–∞ `SET NULL`

---

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó

### –î–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤

1. **–ü–µ—Ä–µ–¥ –≤–∏–¥–∞–ª–µ–Ω–Ω—è–º –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó** –ø–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ –≤–æ–Ω–∞ –±—ñ–ª—å—à–µ –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω–∞
2. **–¢—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó –∑–±–µ—Ä–µ–∂—É—Ç—å—Å—è**, –∞–ª–µ –±—É–¥—É—Ç—å –≤—ñ–¥–æ–±—Ä–∞–∂–∞—Ç–∏—Å—è —è–∫ "–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó"
3. **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏–º–µ** –ø—Ä–∞–≤–∏–ª—å–Ω–æ (–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –ø–æ–ª–µ `type`)
4. **–°–∏—Å—Ç–µ–º–Ω—ñ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó** –Ω–µ –º–æ–∂–Ω–∞ –≤–∏–¥–∞–ª–∏—Ç–∏ (–∑–∞—Ö–∏—â–µ–Ω—ñ)

### –î–ª—è —Ä–æ–∑—Ä–æ–±–Ω–∏–∫—ñ–≤

```php
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞ null –ø–µ—Ä–µ–¥ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó
if ($transaction->category) {
    echo $transaction->category->name;
} else {
    echo '–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó';
}

// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è null-safe operator
echo $transaction->category?->name ?? '–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó';

// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û: –ü—Ä—è–º–µ –∑–≤–µ—Ä–Ω–µ–Ω–Ω—è –±–µ–∑ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏
echo $transaction->category->name; // –ü–æ–º–∏–ª–∫–∞, —è–∫—â–æ category_id = NULL
```

---

## üîÆ –ú–∞–π–±—É—Ç–Ω—ñ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è

### 1. UI –¥–ª—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π –±–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó

–î–æ–¥–∞—Ç–∏ —Ñ—ñ–ª—å—Ç—Ä "–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó" —É —Å–ø–∏—Å–∫—É —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π:

```php
// Scope –¥–ª—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π –±–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó
public function scopeWithoutCategory($query)
{
    return $query->whereNull('category_id');
}
```

### 2. –ú–∞—Å–æ–≤–µ –ø–µ—Ä–µ–ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è –∫–∞—Ç–µ–≥–æ—Ä—ñ–π

–ü–µ—Ä–µ–¥ –≤–∏–¥–∞–ª–µ–Ω–Ω—è–º –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó –∑–∞–ø—Ä–æ–ø–æ–Ω—É–≤–∞—Ç–∏ –ø–µ—Ä–µ–ø—Ä–∏–∑–Ω–∞—á–∏—Ç–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó –Ω–∞ —ñ–Ω—à—É –∫–∞—Ç–µ–≥–æ—Ä—ñ—é:

```
–í–∏–¥–∞–ª–∏—Ç–∏ –∫–∞—Ç–µ–≥–æ—Ä—ñ—é "–¢–∞–∫—Å—ñ"?

[x] –ü–µ—Ä–µ–ø—Ä–∏–∑–Ω–∞—á–∏—Ç–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó –Ω–∞ —ñ–Ω—à—É –∫–∞—Ç–µ–≥–æ—Ä—ñ—é
    –û–±—Ä–∞—Ç–∏ –∫–∞—Ç–µ–≥–æ—Ä—ñ—é: [–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç ‚ñº]

[ ] –ü—Ä–æ—Å—Ç–æ –≤–∏–¥–∞–ª–∏—Ç–∏ (—Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó –∑–∞–ª–∏—à–∞—Ç—å—Å—è –±–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó)

[–í–∏–¥–∞–ª–∏—Ç–∏] [–°–∫–∞—Å—É–≤–∞—Ç–∏]
```

### 3. –ó–≤—ñ—Ç –ø—Ä–æ –≤–∏–¥–∞–ª–µ–Ω–Ω—è

–ü—ñ—Å–ª—è –≤–∏–¥–∞–ª–µ–Ω–Ω—è –ø–æ–∫–∞–∑—É–≤–∞—Ç–∏ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é:

```
‚úÖ –ö–∞—Ç–µ–≥–æ—Ä—ñ—é "–¢–∞–∫—Å—ñ" –≤–∏–¥–∞–ª–µ–Ω–æ

‚ÑπÔ∏è –ó–≤—ñ—Ç:
- –¢—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π –∑–Ω–∞–π–¥–µ–Ω–æ: 5
- –¢—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó –∑–±–µ—Ä–µ–∂–µ–Ω—ñ, –∞–ª–µ —Ç–µ–ø–µ—Ä –±–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó
- –í–∏ –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ —ó—Ö —É —Ä–æ–∑–¥—ñ–ª—ñ "–¢—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó"
  —Ñ—ñ–ª—å—Ç—Ä—É—é—á–∏ –ø–æ "–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó"

[–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó] [–ó–∞–∫—Ä–∏—Ç–∏]
```

---

## üìå –í–∏—Å–Ω–æ–≤–∫–∏

**–ö–æ—Ä—ñ–Ω–Ω–∞ –ø—Ä–∏—á–∏–Ω–∞:** Foreign key constraint `RESTRICT` –±–ª–æ–∫—É–≤–∞–≤ –≤–∏–¥–∞–ª–µ–Ω–Ω—è –∫–∞—Ç–µ–≥–æ—Ä—ñ–π –∑ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—è–º–∏.

**–†—ñ—à–µ–Ω–Ω—è:** –ó–º—ñ–Ω–µ–Ω–æ constraint –Ω–∞ `SET NULL` - –∫–∞—Ç–µ–≥–æ—Ä—ñ—é –º–æ–∂–Ω–∞ –≤–∏–¥–∞–ª–∏—Ç–∏, —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –∑ `category_id = NULL`.

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –º–æ–∂—É—Ç—å **–≤—ñ–ª—å–Ω–æ –≤–∏–¥–∞–ª—è—Ç–∏ –≤–ª–∞—Å–Ω—ñ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó** –±–µ–∑ –≤—Ç—Ä–∞—Ç–∏ —Ñ—ñ–Ω–∞–Ω—Å–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö.

**–ë–µ–∑–ø–µ–∫–∞:** –¢—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å –ø–æ–ª–µ `type`, —Ç–æ–º—É —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–∞ –∑–≤—ñ—Ç–∏ –ø—Ä–∞—Ü—é—é—Ç—å –∫–æ—Ä–µ–∫—Ç–Ω–æ –Ω–∞–≤—ñ—Ç—å –ø—ñ—Å–ª—è –≤–∏–¥–∞–ª–µ–Ω–Ω—è –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó.

---

**–ê–≤—Ç–æ—Ä –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è:** GitHub Copilot  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ —Ç–∞ –ø—Ä–æ—Ç–µ—Å—Ç–æ–≤–∞–Ω–æ  
**–ß–∞—Å –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è:** ~20 —Ö–≤–∏–ª–∏–Ω

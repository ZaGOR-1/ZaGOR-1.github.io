<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîí Security Headers Test - Finance Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
    </style>
</head>
<body class="p-8">
    <div class="max-w-6xl mx-auto">
        <div class="bg-white rounded-2xl shadow-2xl p-8 mb-8">
            <h1 class="text-4xl font-bold text-gray-900 mb-2">üîí –¢–µ—Å—Ç Security Headers</h1>
            <p class="text-gray-600 mb-6">–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ä–æ–±–æ—Ç–∏ –∑–∞—Ö–∏—Å–Ω–∏—Ö –∑–∞–≥–æ–ª–æ–≤–∫—ñ–≤ HTTP</p>
            
            <!-- Status -->
            <div id="status" class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
                <p class="text-blue-800 font-medium">‚è≥ –ê–Ω–∞–ª—ñ–∑ –∑–∞–≥–æ–ª–æ–≤–∫—ñ–≤...</p>
            </div>
        </div>

        <!-- Security Headers -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
            <h2 class="text-2xl font-bold text-gray-900 mb-4">üìã Security Headers</h2>
            <div id="headers" class="space-y-3">
                <p class="text-gray-600">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</p>
            </div>
        </div>

        <!-- Rate Limiting Test -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
            <h2 class="text-2xl font-bold text-gray-900 mb-4">‚ö° Rate Limiting Test</h2>
            <p class="text-gray-600 mb-4">–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –∫–Ω–æ–ø–∫—É –∫—ñ–ª—å–∫–∞ —Ä–∞–∑—ñ–≤ —à–≤–∏–¥–∫–æ (–±—ñ–ª—å—à–µ 60 —Ä–∞–∑—ñ–≤) –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ rate limiting</p>
            <button id="testRateLimitBtn" 
                    class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition font-bold">
                –¢–µ—Å—Ç—É–≤–∞—Ç–∏ API Rate Limit
            </button>
            <div id="rateLimitResult" class="mt-4 space-y-2"></div>
        </div>

        <!-- CSRF Test -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
            <h2 class="text-2xl font-bold text-gray-900 mb-4">üõ°Ô∏è CSRF Protection Test</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="border border-green-200 bg-green-50 rounded-lg p-4">
                    <h3 class="font-bold text-green-800 mb-2">‚úÖ –ó CSRF —Ç–æ–∫–µ–Ω–æ–º</h3>
                    <form id="validForm" action="/api/v1/auth/login" method="POST" class="space-y-2">
                        <input type="hidden" name="_token" value="{{ csrf_token() }}">
                        <input type="email" name="email" value="test@test.com" class="w-full p-2 border rounded text-sm">
                        <input type="password" name="password" value="password" class="w-full p-2 border rounded text-sm">
                        <button type="submit" class="w-full bg-green-600 text-white p-2 rounded hover:bg-green-700 text-sm">
                            –ù–∞–¥—ñ—Å–ª–∞—Ç–∏ (–±–µ–∑–ø–µ—á–Ω–æ)
                        </button>
                    </form>
                    <p class="text-xs text-green-600 mt-2">–ú–∞—î –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ ‚úì</p>
                </div>

                <div class="border border-red-200 bg-red-50 rounded-lg p-4">
                    <h3 class="font-bold text-red-800 mb-2">‚ùå –ë–µ–∑ CSRF —Ç–æ–∫–µ–Ω–∞</h3>
                    <p class="text-sm text-red-700 mb-2">–°–ø—Ä–æ–±–∞ –≤—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ —Ñ–æ—Ä–º—É –±–µ–∑ CSRF —Ç–æ–∫–µ–Ω–∞</p>
                    <button id="invalidCsrf" class="w-full bg-red-600 text-white p-2 rounded hover:bg-red-700 text-sm">
                        –ù–∞–¥—ñ—Å–ª–∞—Ç–∏ (–Ω–µ–±–µ–∑–ø–µ—á–Ω–æ)
                    </button>
                    <p class="text-xs text-red-600 mt-2">–ú–∞—î –±—É—Ç–∏ –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–æ ‚úó</p>
                </div>
            </div>
        </div>

        <!-- Security Score -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
            <h2 class="text-2xl font-bold text-gray-900 mb-4">üèÜ Security Score</h2>
            <div id="securityScore" class="text-center">
                <div class="text-6xl font-bold text-gray-300 mb-2">?</div>
                <p class="text-gray-600">–†–æ–∑—Ä–∞—Ö–æ–≤—É—î—Ç—å—Å—è...</p>
            </div>
        </div>

        <!-- Instructions -->
        <div class="bg-white rounded-xl shadow-lg p-6">
            <h2 class="text-2xl font-bold text-gray-900 mb-4">üìã –©–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—î—Ç—å—Å—è</h2>
            <ul class="space-y-2 text-gray-700">
                <li><strong>X-Frame-Options:</strong> –ó–∞—Ö–∏—Å—Ç –≤—ñ–¥ Clickjacking –∞—Ç–∞–∫</li>
                <li><strong>X-Content-Type-Options:</strong> –ó–∞–ø–æ–±—ñ–≥–∞—î MIME type sniffing</li>
                <li><strong>X-XSS-Protection:</strong> –í–∫–ª—é—á–∞—î XSS —Ñ—ñ–ª—å—Ç—Ä –±—Ä–∞—É–∑–µ—Ä–∞</li>
                <li><strong>Referrer-Policy:</strong> –ö–æ–Ω—Ç—Ä–æ–ª—é—î –ø–µ—Ä–µ–¥–∞—á—É referrer</li>
                <li><strong>Permissions-Policy:</strong> –û–±–º–µ–∂—É—î –¥–æ—Å—Ç—É–ø –¥–æ –±—Ä–∞—É–∑–µ—Ä–Ω–∏—Ö API</li>
                <li><strong>Content-Security-Policy:</strong> –ó–∞—Ö–∏—Å—Ç –≤—ñ–¥ XSS —Ç–∞ injection –∞—Ç–∞–∫</li>
                <li><strong>Strict-Transport-Security:</strong> –ü—Ä–∏–º—É—à—É—î HTTPS (—Ç—ñ–ª—å–∫–∏ –≤ production)</li>
                <li><strong>Rate Limiting:</strong> –ó–∞—Ö–∏—Å—Ç –≤—ñ–¥ brute-force —Ç–∞ DDoS</li>
                <li><strong>CSRF Protection:</strong> –ó–∞—Ö–∏—Å—Ç –≤—ñ–¥ Cross-Site Request Forgery</li>
            </ul>
        </div>
    </div>

    <script>
        // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ security headers
        async function checkSecurityHeaders() {
            try {
                const response = await fetch(window.location.href);
                const headers = response.headers;
                
                const securityHeaders = {
                    'X-Frame-Options': headers.get('x-frame-options'),
                    'X-Content-Type-Options': headers.get('x-content-type-options'),
                    'X-XSS-Protection': headers.get('x-xss-protection'),
                    'Referrer-Policy': headers.get('referrer-policy'),
                    'Permissions-Policy': headers.get('permissions-policy'),
                    'Content-Security-Policy': headers.get('content-security-policy'),
                    'Strict-Transport-Security': headers.get('strict-transport-security'),
                };

                let score = 0;
                let maxScore = 7;
                let html = '';

                for (const [header, value] of Object.entries(securityHeaders)) {
                    const hasValue = value !== null && value !== '';
                    if (hasValue) score++;
                    
                    const color = hasValue ? 'green' : 'red';
                    const icon = hasValue ? '‚úÖ' : '‚ùå';
                    const truncatedValue = value ? (value.length > 60 ? value.substring(0, 60) + '...' : value) : '–í—ñ–¥—Å—É—Ç–Ω—ñ–π';
                    
                    html += `
                        <div class="flex items-start space-x-3 p-3 bg-${color}-50 border border-${color}-200 rounded-lg">
                            <span class="text-2xl">${icon}</span>
                            <div class="flex-1">
                                <p class="font-bold text-${color}-800">${header}</p>
                                <p class="text-sm text-${color}-700 font-mono break-all">${truncatedValue}</p>
                            </div>
                        </div>
                    `;
                }

                document.getElementById('headers').innerHTML = html;

                // Security Score
                const percentage = Math.round((score / maxScore) * 100);
                const scoreColor = percentage >= 80 ? 'green' : percentage >= 60 ? 'yellow' : 'red';
                const scoreGrade = percentage >= 90 ? 'A+' : percentage >= 80 ? 'A' : percentage >= 70 ? 'B' : percentage >= 60 ? 'C' : 'D';
                
                document.getElementById('securityScore').innerHTML = `
                    <div class="text-6xl font-bold text-${scoreColor}-600 mb-2">${scoreGrade}</div>
                    <p class="text-2xl font-bold text-gray-800">${score}/${maxScore} Headers</p>
                    <p class="text-gray-600 mt-2">${percentage}% Security Coverage</p>
                `;

                // Status
                document.getElementById('status').innerHTML = `
                    <p class="text-${scoreColor}-800 font-medium">${icon} Security Headers: ${score}/${maxScore} –∞–∫—Ç–∏–≤–Ω—ñ</p>
                `;
                document.getElementById('status').className = `bg-${scoreColor}-50 border border-${scoreColor}-200 rounded-lg p-4 mb-6`;

            } catch (error) {
                console.error('–ü–æ–º–∏–ª–∫–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ headers:', error);
                document.getElementById('headers').innerHTML = `
                    <p class="text-red-600">–ü–æ–º–∏–ª–∫–∞: ${error.message}</p>
                `;
            }
        }

        // Rate Limiting Test
        let requestCount = 0;
        document.getElementById('testRateLimitBtn').addEventListener('click', async () => {
            requestCount++;
            const resultDiv = document.getElementById('rateLimitResult');
            
            try {
                const response = await fetch('/api/v1/stats/overview', {
                    headers: {
                        'Accept': 'application/json',
                        'X-Requested-With': 'XMLHttpRequest'
                    }
                });

                const rateLimitRemaining = response.headers.get('x-ratelimit-remaining');
                const rateLimitLimit = response.headers.get('x-ratelimit-limit');
                
                if (response.status === 429) {
                    resultDiv.innerHTML = `
                        <div class="bg-red-50 border border-red-200 p-3 rounded-lg">
                            <p class="text-red-800 font-bold">‚ùå Rate Limit Exceeded!</p>
                            <p class="text-red-700 text-sm">–ó–∞–ø–∏—Ç #${requestCount} –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–æ. –°–ø—Ä–æ–±—É–π—Ç–µ —á–µ—Ä–µ–∑ —Ö–≤–∏–ª–∏–Ω—É.</p>
                        </div>
                    ` + resultDiv.innerHTML;
                } else {
                    resultDiv.innerHTML = `
                        <div class="bg-green-50 border border-green-200 p-3 rounded-lg">
                            <p class="text-green-800 font-bold">‚úÖ –ó–∞–ø–∏—Ç #${requestCount} —É—Å–ø—ñ—à–Ω–∏–π</p>
                            <p class="text-green-700 text-sm">–ó–∞–ª–∏—à–∏–ª–æ—Å—å: ${rateLimitRemaining}/${rateLimitLimit} –∑–∞–ø–∏—Ç—ñ–≤</p>
                        </div>
                    ` + resultDiv.innerHTML;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="bg-yellow-50 border border-yellow-200 p-3 rounded-lg">
                        <p class="text-yellow-800">‚ö†Ô∏è –ü–æ–º–∏–ª–∫–∞: ${error.message}</p>
                    </div>
                ` + resultDiv.innerHTML;
            }
        });

        // CSRF Test
        document.getElementById('invalidCsrf').addEventListener('click', async () => {
            try {
                const response = await fetch('/api/v1/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify({
                        email: 'test@test.com',
                        password: 'password'
                    })
                });

                if (response.status === 419) {
                    alert('‚úÖ CSRF Protection –ø—Ä–∞—Ü—é—î! –ó–∞–ø–∏—Ç –±–µ–∑ —Ç–æ–∫–µ–Ω–∞ –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–æ (419 CSRF Token Mismatch)');
                } else {
                    alert('‚ö†Ô∏è –ó–∞–ø–∏—Ç –ø—Ä–æ–π—à–æ–≤ (—Ü–µ –º–æ–∂–µ –±—É—Ç–∏ API endpoint –±–µ–∑ CSRF, —â–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ)');
                }
            } catch (error) {
                alert('‚ùå –ü–æ–º–∏–ª–∫–∞: ' + error.message);
            }
        });

        // –ó–∞–ø—É—Å–∫–∞—î–º–æ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É
        checkSecurityHeaders();
    </script>
</body>
</html>
